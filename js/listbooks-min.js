var booklistContent=document.getElementById("booklist-content"),booklistError=document.getElementById("booklist-error"),booklistSort=document.getElementById("booklist-sort"),bookTemplate=document.getElementById("book-template"),xhr=new XMLHttpRequest,books=[],sortByKeys=function(){function e(e,t,o,n){var r="";return r="descending"===n?firstBy(t,{ignoreCase:!0,direction:-1}).thenBy(o,{ignoreCase:!0,direction:-1}):firstBy(t,{ignoreCase:!0}).thenBy(o,{ignoreCase:!0}),e.sort(r)}return e}(),buildHTML=function(){function e(e){if("content"in document.createElement("template")){booklistContent.innerHTML="";for(var t=0;t<e.length;t+=1){var o=document.importNode(bookTemplate.content,!0);o.querySelector(".book--title").innerHTML=e[t].title,o.querySelector(".book--author").innerHTML=e[t].author,o.querySelector(".book--rating").innerHTML=e[t].rating,o.querySelector(".book--length").innerHTML=e[t].length,e[t].series&&(o.querySelector(".book--series").innerHTML=String(e[t].series.number)+"/"+String(e[t].series.length)),booklistContent.appendChild(o)}}else{booklistError.innerHTML="Oh no! Your browser doesn't support template!"}}return e}(),sortBy=function(){function e(){var e=this.options[this.selectedIndex];sortByKeys(books,e.value,e.dataset.sortSecondary,e.dataset.sortOrder),buildHTML(books)}return e}();booklistSort.addEventListener("change",sortBy),xhr.open("GET","data/books.json",!0),xhr.onload=function(){function e(){if(xhr.status>=200&&xhr.status<400)books=JSON.parse(xhr.responseText),booklistSort.dispatchEvent(new Event("change"));else{booklistError.innerHTML="Whoops! Something went wrong. Please try again."}}return e}(),xhr.onerror=function(){function e(){booklistError.innerHTML="Whoops! We couldn't reach the server. Please try again."}return e}(),xhr.send();