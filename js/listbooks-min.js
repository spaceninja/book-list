var apiKey="AIzaSyDyHFhssmD7wLArMDhaUzZoEX1PwQQwakA",apiURL="https://www.googleapis.com/books/v1/volumes",apiFields="items(id,volumeInfo(description,pageCount,averageRating,imageLinks),searchInfo)",booklistContent=document.getElementById("booklist-content"),booklistError=document.getElementById("booklist-error"),booklistSort=document.getElementById("booklist-sort"),bookTemplate=document.getElementById("book-template"),xhr=new XMLHttpRequest,books=[],parseBooks=function(){function e(e){for(var o=e,t=0;t<o.length;t+=1)o[t].rating=o[t].rating.toFixed(1),fetch(apiURL+"?q=isbn:"+String(o[t].isbn)+"&key="+apiKey+"&fields="+apiFields,{method:"get"}).then(function(e){return e.json()}).then(function(e){console.log(e)}).catch(function(e){booklistError.innerHTML=e});return o}return e}(),sortByKeys=function(){function e(e,o,t,n,r){var i={ignoreCase:!0,direction:"descending"===t?-1:0},s={ignoreCase:!0,direction:"descending"===r?-1:0},a=firstBy(o,i).thenBy(n,s);return e.sort(a)}return e}(),buildHTML=function(){function e(e){if("content"in document.createElement("template")){booklistContent.innerHTML="";for(var o=0;o<e.length;o+=1){var t=document.importNode(bookTemplate.content,!0);t.querySelector(".book--title").innerHTML=e[o].title,t.querySelector(".book--author").innerHTML=e[o].author,t.querySelector(".book--rating").innerHTML=e[o].rating,t.querySelector(".book--length").innerHTML=e[o].length,e[o].series&&(t.querySelector(".book--series").innerHTML=e[o].series),booklistContent.appendChild(t)}}else{booklistError.innerHTML="Oh no! Your browser doesn't support templates!"}}return e}(),sortBy=function(){function e(){var e=this.options[this.selectedIndex];sortByKeys(books,e.value,e.dataset.sortOrder,e.dataset.sortSecondary,e.dataset.sortSecondaryOrder),buildHTML(books)}return e}();booklistSort.addEventListener("change",sortBy),xhr.open("GET","data/books.json",!0),xhr.onload=function(){function e(){if(xhr.status>=200&&xhr.status<400)books=parseBooks(JSON.parse(xhr.responseText)),booklistSort.dispatchEvent(new Event("change"));else{booklistError.innerHTML="Whoops! Something went wrong. Please try again."}}return e}(),xhr.onerror=function(){function e(){booklistError.innerHTML="Whoops! We couldn't reach the server. Please try again."}return e}(),xhr.send();